<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="author" content="Guru Devanla">
        <title>Handling Missing Values - CSV loading in Haskell</title>

        <!--web fonts-->
        <link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Belgrano" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="/theme/css/main.css" />
        <link rel="stylesheet" href="/theme/css/pygment.css"/>
        <link rel="stylesheet" href="/theme/css/emacs.css"/>


           <script type="text/javascript">

               var _gaq = _gaq || [];
                 _gaq.push(['_setAccount', 'UA-45968778-1']);
                 _gaq.push(['_trackPageview']);

                 (function() {
                   var ga = document.createElement('script'); ga.type =
                   'text/javascript'; ga.async = true;
                   ga.src = ('https:' == document.location.protocol ?
                   'https://ssl' : 'http://www') +
                   '.google-analytics.com/ga.js';
                   var s = document.getElementsByTagName('script')[0];
                   s.parentNode.insertBefore(ga, s);
                 })();

               </script>

        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
              Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-45968778-2', 'gdevanla.github.io');
              ga('send', 'pageview');

        </script>
</head>

<body>
    <header>
        <span><a class="title" href="/index.html"><h1>blog <| code </h1></a></span>
        <nav>
            <ul>
                    <li><a href="/index.html">posts</a></li>
                    <li><a href="/archives.html">archives</a></li>
                    <li><a href="/pages/who-am-i.html">about</a></li>
            </ul>
        </nav>
    </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h2>
        <a class="title" href="/drafts/csv-parsing-in-haskell.html" rel="bookmark"
           title="Permalink to Handling Missing Values - CSV loading in Haskell">Handling Missing Values - CSV loading in Haskell</a></h2>
      <div class="extra-info">
                <abbr class="published" title="2016-09-05T07:37:43.055411-07:00">
                    05 09 2016
                </abbr>
                In <a href="/category/haskell-csv-parsing.html">Haskell, csv parsing</a>.       </div><!-- /.entry-content -->

    </header>
    <p>Working with Pandas(in Python) and loading a CSV file is simple as</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/tmp/foo.txt&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>But, it is not a one-liner in Haskell. Very recently, I ended up using
the <code>Data.Csv</code> library to load some csv file  I had to work
with. The <a href="link here">document-TODO</a> on the site is very good and you should check
it out. I came across a few scenarios, I had to handle which was not
directly obvious from the documentation. I have documented a few of
them below.</p>
<p>Our sample csv file looks as follows:</p>
<p>1) It has 2 columns</p>
<p>2) The value in the third row, second column is missing</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ cat haskell_csv_example.csv

name,current_balance
vacation,1000
loan payment,-2000
grand dinner,
</pre></div>
</td></tr></table>

<p>We would like to map this data into a record type we already have in
our haskell code. Say, the record we have is defined as follows</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="kr">data</span> <span class="kt">SavingsPlan</span> <span class="ow">=</span> <span class="kt">SavingPlan</span> <span class="p">{</span> <span class="n">savingsName</span><span class="ow">::</span><span class="kt">String</span>
                       <span class="p">,</span> <span class="n">currentSavingsBalance</span><span class="ow">::</span><span class="kt">Double</span>
                       <span class="p">,</span> <span class="n">future_allocation</span><span class="ow">::</span> <span class="kt">Double</span> <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Notice here that we have an extra field constructor in our record. We
will assume the value of this attribute is set in the program based on
certain computations.</p>
<p>Our tasks is to load data from the following csv file into the record
type declared above</p>
<p>If it was not for the missing values, and extra field constructor in
our program, the straight forward way to load data into this record
would be</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="kr">instance</span> <span class="kt">FromNamedRecord</span> <span class="kt">SavingsPlan</span> <span class="kr">where</span>
      <span class="n">parseNamedRecord</span> <span class="n">r</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">SavingsPlan</span> <span class="o">&lt;$&gt;</span> <span class="n">r</span> <span class="o">.:</span> <span class="s">&quot;name&quot;</span>
                            <span class="o">&lt;*&gt;</span> <span class="n">r</span> <span class="o">.:</span> <span class="s">&quot;current_balance&quot;</span><span class="p">)</span>
                            <span class="o">&lt;*&gt;</span> <span class="n">pure</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Note, that we use <code>pure (Just 0)</code> as a default value into the
<code>balance</code> field since that input is not part of the csv file.</p>
<p>Now, we also need to handle missing values, in the savings column. To
     fix that we will have to slightly update our loading routines</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">defaultToZero</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Double</span>
    <span class="n">defaultToZero</span> <span class="n">s</span>
      <span class="o">|</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="ow">=</span> <span class="mf">0.0</span>
      <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="p">(</span><span class="n">read</span> <span class="n">s</span><span class="p">)</span><span class="ow">::</span><span class="kt">Double</span>


    <span class="kr">instance</span> <span class="kt">FromNamedRecord</span> <span class="kt">SavingsPlan</span> <span class="kr">where</span>
      <span class="n">parseNamedRecord</span> <span class="n">r</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">SavingsPlan</span> <span class="o">&lt;$&gt;</span> <span class="n">r</span> <span class="o">.:</span> <span class="s">&quot;name&quot;</span>
                            <span class="o">&lt;*&gt;</span> <span class="n">fmap</span> <span class="n">defaultToZero</span> <span class="p">(</span><span class="n">r</span> <span class="o">.:</span> <span class="s">&quot;current_balance&quot;</span><span class="p">)</span>
                            <span class="o">&lt;*&gt;</span> <span class="n">pure</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Notice, that we are providing a mapping function <code>defaultToZero</code>
while trying to parse the value into the <code>current_balance</code> field.
This usage and an alternate usage of mapping loaded values are also
decribed in the official documentation with other examples. The
alternate is to implement an custom instance of FromField for the data
type that needs to be handled.</p>
<p>Here is one more example,</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="c1">-- converting numeric 0 and 1&#39;s to MayBe Bool values</span>
    <span class="n">convertToBool</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Bool</span>
    <span class="n">convertToBool</span> <span class="n">s</span>
      <span class="o">|</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="o">||</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="kt">False</span>
      <span class="o">|</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&quot;1&quot;</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="kt">True</span>
      <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="ne">error</span> <span class="p">(</span><span class="s">&quot;Unrecognized Character&quot;</span> <span class="o">++</span> <span class="n">s</span><span class="p">)</span>
</pre></div>
</td></tr></table>


  </article>
</section>
    <footer>
        <hr>
        <div class="social">
            <ul>
                <li><a href="http://github.com/gdevanla">GitHub</a></li>
                <li><a href="http://twitter.com/grdvnl">Twitter</a></li>
            </ul>
            <ul>
                <li>
                    Powered by Pelican
                </li>
            </ul>
        </div><!-- /.social -->


<!--  -->

</body>
</html>